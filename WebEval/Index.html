
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>UNCW WebEval</title>
    <link href="Content/bootstrap.css" rel="stylesheet" type="text/css" />
</head>
<body style="height: 605px">
    <form id="form1">
        <div>
            <h1 style="text-align: left">
            <img alt="" src="/images/house_teal.gif" height="87"/>
                WebEval
            </h1>
            <h2>Log</h2>
            <pre id="log"></pre>
        </div>
        <div id="loginBlock" style="visibility: visible">
               <p style="text-align: left">
                   UNCW Id Number
                <br />
                <input id="dblUNCWId" type="text" /><br />
                <button type="button" id="btnLoginSubmit" class="btn-success" onclick="loginSubmit()">Submit</button>
            </p>
            <div style="width: auto; margin:0 auto; text-align: center;">
            </div>
            <div id="questions" style="visibility: hidden; text-align: center;">
                <input id="questionsText" type="text" readonly/></div>
            <div id="recording" style="visibility:hidden; text-align: center;">
                <img id="btnLeft" src="images/left_arrow.png" height="77" width="173" onclick="left_arrow_Click()" />
                        <div class="divider"></div>

                        <img id="btnRight" height="77" src="images/right_arrow.png" width="173" onclick="right_arrow_Click()" />

                        <br />
                        <img id="btnRecord" height="70" src="images/record_button.png" width="70" onclick="startRecording()" />
                        <div class="divider"></div>
                        <img id="btnStop" height="70" src="images/stop_button.png" width="70" onclick="stopRecording()" />
                        <div class="divider"></div>
                        <img id="btnPlay" height="70" src="images/play_button.png" width="70" onclick="playRecording()" />
                        <div class="divider"></div>
                        <img id="btnReset" height="70" src="images/pause_button.png" width="70" onclick="restartRecording()" />

      
            </div>
            <div>
                <updatepanel ID="Previous_responses" style="width:800px; margin:0 auto; text-align: center;" UpdateMode="Conditional">
                    <ContentTemplate>
                        <GridView ID="dgvResponses">
                        </GridView>
                    </ContentTemplate>
                </updatepanel>
            </div>
        </div>


    </form>
    <script src="scripts/install.js"></script>

    <script src="scripts/mediaDevices-getUserMedia-polyfill.js"></script>
    <!-- Below is your custom application script -->
    <script src="scripts/app.js"></script>
    <script src="scripts/recorder.js"></script>
    <script src="scripts/backend.js"></script>

    <script type="text/javascript">

        function nextQuestion() {

        }

        function __log(e, data) {
            log.innerHTML += "\n" + e + " " + (data || '');
        }

        var audio_context;
        var recorder;

        function startUserMedia(stream) {
            var input = audio_context.createMediaStreamSource(stream);
            __log('Media stream created.');

            // Uncomment if you want the audio to feedback directly
            //input.connect(audio_context.destination);
            //__log('Input connected to audio context destination.');

            recorder = new Recorder(input);
            __log('Recorder initialised.');
        }

        function startRecording() {
            recorder && recorder.record();
            document.getElementById("btnRecord").disabled = true;
            document.getElementById("btnStop").disabled = false;
            document.getElementById("btnPlay").disabled = true;
            document.getElementById("btnReset").disabled = true;
            __log('Recording...');
        }

        function stopRecording() {
            recorder && recorder.stop();
            document.getElementById("btnRecord").disabled = false;
            document.getElementById("btnPlay").disabled = false;
            document.getElementById("btnStop").disabled = false;
            document.getElementById("btnReset").disabled = false;


            __log('Stopped recording.');

            // create WAV download link using audio data blob


        }

        function restartRecording() {
            document.getElementById("btnRecord").disabled = false;
            document.getElementById("btnPlay").disabled = true;
            document.getElementById("btnStop").disabled = true;
            document.getElementById("btnReset").disabled = true;


            recorder && recorder.clear();
            recorder.clear();
        }

        function playRecording() {
            recorder && recorder.exportWAV(function (blob) {
                var url = URL.createObjectURL(blob);
                var audio = document.createElement('audio');
                audio.src = url;
                console.log(audio);
                audio.play();
            });
        }

        window.onload = function init() {
            try {
                // webkit shim
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
                window.URL = window.URL || window.webkitURL;

                audio_context = new AudioContext;
                __log('Audio context set up.');
                __log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
            } catch (e) {
                alert('No web audio support in this browser!');
            }

            navigator.getUserMedia({ audio: true }, startUserMedia, function (e) {
                __log('No live audio input: ' + e);
            });
        };

    </script>

</body>
</html>
